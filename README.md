# Task Management API - Crehana FastAPI

Una API robusta de gesti√≥n de tareas construida con FastAPI, implementando Clean Architecture, autenticaci√≥n JWT, y containerizada con Docker.

## üìã Descripci√≥n del Proyecto

Este proyecto es un sistema completo de gesti√≥n de tareas que permite:

- ‚úÖ **Gesti√≥n de Usuarios**: Registro, login y autenticaci√≥n con JWT
- ‚úÖ **Listas de Tareas**: Crear, leer, actualizar y eliminar listas de tareas
- ‚úÖ **Tareas**: CRUD completo con asignaci√≥n de usuarios, estados y prioridades
- ‚úÖ **Filtrado y B√∫squeda**: B√∫squeda por t√≠tulo, filtrado por estado, prioridad, usuario
- ‚úÖ **Notificaciones**: Sistema de notificaciones por email (mock)
- ‚úÖ **Arquitectura Limpia**: Separaci√≥n clara de responsabilidades
- ‚úÖ **Base de Datos**: PostgreSQL con migraciones usando Alembic
- ‚úÖ **Testing**: Cobertura >89% con tests unitarios e integraci√≥n
- ‚úÖ **Calidad de C√≥digo**: Linting con flake8, formateo con black, type hints

### üèóÔ∏è Arquitectura

```
app/
‚îú‚îÄ‚îÄ api/              # Capa de presentaci√≥n (endpoints, dependencias)
‚îú‚îÄ‚îÄ domain/           # Modelos de dominio y value objects
‚îú‚îÄ‚îÄ use_cases/        # Casos de uso (l√≥gica de negocio)
‚îú‚îÄ‚îÄ services/         # Servicios de aplicaci√≥n
‚îú‚îÄ‚îÄ infrastructure/   # Base de datos, repositories, externos
‚îî‚îÄ‚îÄ schemas/          # Schemas de Pydantic para validaci√≥n
```

### üõ†Ô∏è Stack Tecnol√≥gico

- **Framework**: FastAPI 0.115
- **Base de Datos**: PostgreSQL 15
- **ORM**: SQLAlchemy 2.0
- **Migraciones**: Alembic
- **Autenticaci√≥n**: JWT con bcrypt
- **Testing**: pytest, coverage
- **Linting**: flake8, black, isort, ruff
- **Containerizaci√≥n**: Docker & Docker Compose
- **Python**: 3.9+

## üöÄ Configuraci√≥n del Entorno Local

### Prerrequisitos

Aseg√∫rate de tener instalados los siguientes componentes seg√∫n tu sistema operativo:

#### üêß Linux (Ubuntu/Debian)
```bash
# Actualizar sistema
sudo apt update && sudo apt upgrade -y

# Python 3.9+ (si no est√° instalado)
sudo apt install python3.9 python3.9-venv python3.9-dev python3-pip

# PostgreSQL (opcional para desarrollo local)
sudo apt install postgresql postgresql-contrib

# Git
sudo apt install git

# Docker (opcional)
sudo apt install docker.io docker-compose
sudo usermod -aG docker $USER  # Reiniciar sesi√≥n despu√©s
```

#### üçé macOS
```bash
# Instalar Homebrew (si no est√° instalado)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# Python 3.9+
brew install python@3.9

# PostgreSQL (opcional)
brew install postgresql@15
brew services start postgresql@15

# Git (usualmente ya est√° instalado)
brew install git

# Docker (opcional)
brew install --cask docker
```

#### ü™ü Windows
```powershell
# Opci√≥n 1: Usando Chocolatey (recomendado)
# Instalar Chocolatey primero: https://chocolatey.org/install

choco install python --version=3.9.0
choco install postgresql --version=15.0
choco install git
choco install docker-desktop

# Opci√≥n 2: Descarga manual
# Python: https://www.python.org/downloads/
# PostgreSQL: https://www.postgresql.org/download/windows/
# Git: https://git-scm.com/download/win
# Docker Desktop: https://www.docker.com/products/docker-desktop
```

### üì¶ Instalaci√≥n del Proyecto

#### 1. Clonar el repositorio
```bash
git clone git@github.com:allanos94/crehana_fastapi.git
cd crehana_fastapi
```

#### 2. Crear entorno virtual

**Linux/macOS:**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

**Windows (PowerShell):**
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

**Windows (CMD):**
```cmd
python -m venv .venv
.venv\Scripts\activate.bat
```

#### 3. Instalar dependencias

```bash
# Dependencias de desarrollo (incluye testing y linting)
pip install -r requirements/dev.txt

# O solo dependencias de producci√≥n
pip install -r requirements/prod.txt
```

#### 4. Configurar variables de entorno

```bash
# Copiar archivo de ejemplo
cp .env-example .env

# Editar .env con tu configuraci√≥n
# DATABASE_URL=postgresql+psycopg2://postgres:postgres@localhost:5433/tareas_db
# SECRET_KEY=tu_secret_key_super_seguro_aqui
# ACCESS_TOKEN_EXPIRE_MINUTES=30
```

#### 5. Configurar base de datos

**Opci√≥n A: PostgreSQL local**
```bash
# Linux/macOS
sudo -u postgres createdb tareas_db

# Windows (desde psql)
psql -U postgres
CREATE DATABASE tareas_db;
\q
```

**Opci√≥n B: Docker (recomendado)**
```bash
# Solo la base de datos
docker run --name postgres-tareas \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=tareas_db \
  -p 5433:5432 -d postgres:15
```

#### 6. Ejecutar migraciones

```bash
# Aplicar migraciones
make migrate

# O manualmente seg√∫n tu SO:
# Linux/macOS:
DATABASE_URL='postgresql+psycopg2://postgres:postgres@localhost:5433/tareas_db' alembic upgrade head

# Windows (PowerShell):
$env:DATABASE_URL='postgresql+psycopg2://postgres:postgres@localhost:5433/tareas_db'; alembic upgrade head

# Windows (CMD):
set DATABASE_URL=postgresql+psycopg2://postgres:postgres@localhost:5433/tareas_db && alembic upgrade head
```

#### 7. Ejecutar la aplicaci√≥n

```bash
# Con Make (recomendado)
make run-local

# O manualmente
uvicorn app.api.main:app --host 0.0.0.0 --port 8000 --reload
```

La API estar√° disponible en: http://localhost:8000

- üìñ **Documentaci√≥n**: http://localhost:8000/docs
- üîç **ReDoc**: http://localhost:8000/redoc

## üê≥ Ejecutar con Docker

Docker simplifica el despliegue y garantiza consistencia entre entornos.

### Prerrequisitos Docker

#### üêß Linux
```bash
# Ubuntu/Debian
sudo apt install docker.io docker-compose
sudo usermod -aG docker $USER
# Reiniciar sesi√≥n o ejecutar: newgrp docker
```

#### üçé macOS
```bash
brew install --cask docker
# O descargar Docker Desktop desde: https://www.docker.com/products/docker-desktop
```

#### ü™ü Windows
```powershell
# Con Chocolatey
choco install docker-desktop

# O descargar Docker Desktop desde: https://www.docker.com/products/docker-desktop
# Aseg√∫rate de habilitar WSL 2 backend
```

### üîß Entorno de Desarrollo

```bash
# Construir y ejecutar contenedores de desarrollo
make dev

# O manualmente
docker-compose -f docker-compose.dev.yml up --build -d
```

**Servicios incluidos:**
- üöÄ **Backend FastAPI**: http://localhost:8000 (hot reload activado)
- üóÑÔ∏è **PostgreSQL**: localhost:5433
- üìÅ **Vol√∫menes**: C√≥digo sincronizado para desarrollo

### üè≠ Entorno de Producci√≥n

```bash
# Construir y ejecutar contenedores de producci√≥n
make prod

# O manualmente
docker-compose -f docker-compose.prod.yml up --build -d
```

### üìã Comandos Docker √ötiles

```bash
# Ver logs
docker-compose -f docker-compose.dev.yml logs -f

# Acceder al contenedor backend
docker-compose -f docker-compose.dev.yml exec backend bash

# Ejecutar migraciones en Docker
docker-compose -f docker-compose.dev.yml exec backend alembic upgrade head

# Parar servicios
docker-compose -f docker-compose.dev.yml down

# Limpiar (eliminar vol√∫menes)
make clean
```

## üß™ Ejecutar Pruebas

El proyecto incluye una suite completa de tests con >89% de cobertura.

### üöÄ Comandos Make (Recomendado)

```bash
# Ejecutar todos los tests con cobertura
make test

# Solo tests unitarios
make test-unit

# Solo tests de integraci√≥n
make test-integration

# Generar reporte HTML de cobertura
make test-coverage
```

### üîß Comandos Manuales

#### Todos los Tests
```bash
# Linux/macOS
python -m pytest tests/ --cov=app --cov-report=term-missing --cov-fail-under=75

# Windows (PowerShell)
python -m pytest tests/ --cov=app --cov-report=term-missing --cov-fail-under=75

# Windows (CMD)
python -m pytest tests/ --cov=app --cov-report=term-missing --cov-fail-under=75
```

#### Tests Espec√≠ficos
```bash
# Tests unitarios
python -m pytest tests/unit/ -v

# Tests de integraci√≥n
python -m pytest tests/integration/ -v

# Test espec√≠fico
python -m pytest tests/unit/test_auth_service.py::TestAuthService::test_password_hashing -v

# Con marcadores
python -m pytest -m "not slow" -v
python -m pytest -m "auth" -v
```

#### Opciones Avanzadas
```bash
# Ejecutar en paralelo (si tienes pytest-xdist)
python -m pytest tests/ -n auto

# Con output detallado
python -m pytest tests/ -v -s

# Solo tests que fallaron la √∫ltima vez
python -m pytest tests/ --lf

# Detener en el primer fallo
python -m pytest tests/ -x

# Generar reporte de cobertura HTML
python -m pytest tests/ --cov=app --cov-report=html
```

### üìä Interpretaci√≥n de Cobertura

```bash
# El reporte mostrar√° algo como:
Name                               Stmts   Miss  Cover   Missing
----------------------------------------------------------------
app/api/v1/endpoints/auth.py         31      0   100%
app/services/auth.py                 38      0   100%
app/infrastructure/db/models.py      50      5    90%   23-27
----------------------------------------------------------------
TOTAL                               997    109    89%
```

- **Stmts**: L√≠neas de c√≥digo
- **Miss**: L√≠neas no cubiertas por tests
- **Cover**: Porcentaje de cobertura
- **Missing**: N√∫meros de l√≠nea espec√≠ficos sin cobertura

## üõ†Ô∏è Herramientas de Desarrollo

### üé® Formateo y Linting

```bash
# Verificar estilo de c√≥digo
make check-style

# Formatear c√≥digo autom√°ticamente
make format

# Linting completo
make lint

# Arreglar problemas autom√°ticamente
make lint-fix
```

### üîß Pre-commit (Recomendado)

Pre-commit ejecuta autom√°ticamente verificaciones antes de cada commit:

```bash
# Instalar hooks (solo primera vez)
make install-hooks

# Ejecutar en todos los archivos
make pre-commit-all

# Actualizar hooks
make pre-commit-update
```

**Uso autom√°tico**: Una vez instalado, pre-commit se ejecuta autom√°ticamente en cada `git commit`.

### üóÑÔ∏è Gesti√≥n de Base de Datos

```bash
# Crear migraci√≥n autom√°tica
make migrations

# Aplicar migraciones
make migrate

# Ver historial de migraciones
make migrate-history

# Rollback de migraci√≥n
make migrate-down

# Crear migraci√≥n manual
make migrate-create MESSAGE="add_user_avatar"
```

### üì¶ Gesti√≥n de Dependencias

```bash
# Actualizar archivos de dependencias
make update-deps

# Instalar dependencias de desarrollo
make install-dev

# Instalar dependencias de producci√≥n
make install-prod
```

## üåê API Endpoints

### üîê Autenticaci√≥n
- `POST /auth/register` - Registro de usuario
- `POST /auth/login` - Login (obtener token JWT)
- `GET /auth/me` - Informaci√≥n del usuario actual

### üìù Listas de Tareas
- `GET /task-lists/` - Listar listas de tareas
- `POST /task-lists/` - Crear lista de tareas
- `GET /task-lists/{id}` - Obtener lista espec√≠fica
- `PUT /task-lists/{id}` - Actualizar lista
- `DELETE /task-lists/{id}` - Eliminar lista

### ‚úÖ Tareas
- `GET /tasks/` - Listar tareas (con filtros)
- `POST /tasks/` - Crear tarea
- `GET /tasks/{id}` - Obtener tarea espec√≠fica
- `PUT /tasks/{id}` - Actualizar tarea
- `DELETE /tasks/{id}` - Eliminar tarea
- `POST /tasks/{id}/assign` - Asignar tarea a usuario
- `POST /tasks/{id}/unassign` - Desasignar tarea

### üì± Ejemplos de Uso

```bash
# Registrar usuario
curl -X POST "http://localhost:8000/auth/register" \
  -H "Content-Type: application/json" \
  -d '{"email": "usuario@ejemplo.com", "password": "mi_password"}'

# Login
curl -X POST "http://localhost:8000/auth/login" \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=usuario@ejemplo.com&password=mi_password"

# Crear lista de tareas (con token)
curl -X POST "http://localhost:8000/task-lists/" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE" \
  -H "Content-Type: application/json" \
  -d '{"name": "Mi Lista de Tareas"}'
```

## ‚ö†Ô∏è Consideraciones Importantes

### üîí Seguridad
- **SECRET_KEY**: Usa una clave secreta fuerte en producci√≥n
- **DATABASE_URL**: No incluyas credenciales en el c√≥digo
- **CORS**: Configura dominios permitidos en producci√≥n
- **HTTPS**: Usa siempre HTTPS en producci√≥n

### üèóÔ∏è Producci√≥n
- **Variables de Entorno**: Usa un gestor de secretos
- **Base de Datos**: Configura backup autom√°tico
- **Logs**: Implementa logging centralizado
- **Monitoreo**: Agrega m√©tricas y health checks
- **Reverse Proxy**: Usa Nginx o similar

### üñ•Ô∏è Diferencias por SO

#### Linux
- Usa `sudo` para comandos de sistema
- PostgreSQL por defecto en puerto 5432
- Paths con `/` (slash)

#### macOS
- Homebrew como gestor de paquetes
- Mismo comportamiento que Linux
- Puede requerir permisos adicionales para Docker

#### Windows
- PowerShell recomendado sobre CMD
- Paths con `\` (backslash)
- Variables de entorno diferentes (`$env:` vs `export`)
- WSL2 recomendado para mejor compatibilidad Docker

### üêõ Soluci√≥n de Problemas Comunes

#### Puerto en uso
```bash
# Linux/macOS
sudo lsof -i :8000
kill -9 <PID>

# Windows
netstat -ano | findstr :8000
taskkill /PID <PID> /F
```

#### Problemas de permisos Docker
```bash
# Linux
sudo usermod -aG docker $USER
newgrp docker

# Windows: Ejecutar PowerShell como administrador
```

#### Base de datos no responde
```bash
# Verificar que PostgreSQL est√© corriendo
# Linux
sudo systemctl status postgresql

# macOS
brew services list | grep postgresql

# Windows
services.msc  # Buscar PostgreSQL
```

## üìö Recursos Adicionales

- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [SQLAlchemy 2.0](https://docs.sqlalchemy.org/en/20/)
- [Alembic Documentation](https://alembic.sqlalchemy.org/)
- [pytest Documentation](https://docs.pytest.org/)
- [Docker Documentation](https://docs.docker.com/)

## ü§ù Contribuci√≥n

1. Fork el proyecto
2. Crea una rama para tu feature (`git checkout -b feature/nueva-funcionalidad`)
3. Haz commit de tus cambios (`git commit -am 'Agrega nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Abre un Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la licencia MIT. Ver archivo `LICENSE` para m√°s detalles.
